@@include('../_includes/html-head.html', {"title": "Landing - Checkout", "path":"../"})

<body class="checkout-page">
	
@@include('../_includes/header.html')

<section class="inner-page-hero">
	 <div>
		<div class="title-container">
			<div class="container">
				<h1>Checkout</h1>
			</div>
		</div>
	   
		
		<!-- img data-v-post-image src="img/bg-img/bg-7.jpg" alt="" -->
	</div>
</section>

<main id="site-content" role="main">
<!-- Page Content -->
<div class="container">

@@include('../_includes/notifications.html')
	
<div data-if-not="order.id_order">

	@@include('_checkout-login.html')
	
	<form action method="post" enctype="multipart/form-data">
	 <div class="container">
		<div class="row">

			<div class="col-12 col-md-7">
				<div class="card" style="--bs-card-spacer-y: 1.5rem; --bs-card-spacer-x: 1.5rem; ">
					<div class="card-body">
						<div class="row" data-v-if-not="this.global.user_id">

						  <div class="mb-3 col-6" id="first_name_group">
								<label class="col-form-label" for="first_name">First Name <span class="text-danger text-small">*</span></label>
								<input type="text" class="form-control" id="first_name" name="first_name" value="" minlength="3" required>
							</div>
							<div class="mb-3 col-6" id="last_name_group">
								<label class="col-form-label" for="last_name">Last Name <span class="text-danger text-small">*</span></label>
								<input type="text" class="form-control" id="last_name" name="last_name" value="" minlength="3" required>
							</div>
							<div class="mb-3 col-12 mb-3" id="email_group">
								<label class="col-form-label" for="email">Email Address <span class="text-danger text-small">*</span></label>
								<input type="email" class="form-control" id="email" name="email" value="" required>
							</div>                            
							<!--
							<div class="mb-3 col-12 mb-3" id="company_group">
								<label class="col-form-label" for="company">Company Name</label>
								<input type="text" class="form-control" id="company" name="company" value="">
							</div>
							-->
							
							@@include('_register_account.html')
							
						</div>

						@@include('_billing_address.html')

						@@include('_shipping_address.html')
						
						<div class="mb-3">
							<div class="form-check mb-1">
								<input type="checkbox" class="form-check-input" id="terms" name="terms" required>
								<label class="form-check-label" for="terms"></span>I agree to</span><a href="page/terms-conditions" target="_blank" data-v-url="content/page/index" data-v-url-params='{"slug":"terms-conditions"}'>Terms and conditions</a></label>
							</div>
							<div class="form-check mb-1">
								<input type="checkbox" class="form-check-input" id="newsletter" name="newsletter">
								<label class="form-check-label" for="newsletter">Subscribe to our newsletter</label>
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="col-12 col-md-5 ms-lg-auto">
				<div class="card">
					<div class="card-body">
						
						@@include('./_checkout-cart-summary.html')

						<div class="input-group mb-3">
							<input type="text" class="form-control" id="coupon_code" placeholder="Coupon Code" aria-label="Coupon Code" aria-describedby="button-addon2">
							<button class="btn btn-primary btn-sm px-4" type="button">Apply</button>
						</div>
						
						@@include('./_shipping.html')

						@@include('./_payment.html')

						<div class="mb-3">
							<label for="notes">Order Notes</label>
							<textarea name="notes" id="notes" cols="30" rows="5" class="form-control" placeholder=""></textarea>
						</div>

						<button type="submit" href="" class="btn btn-primary w-100" data-v-url="checkout/checkout/confirm">
							Place order <i class="la la-arrow-right"></i>
						</button>
				</div>
				</div>
			</div>
		</div>
	</div>
	</form>
</div>

</div>
</main>

@@include('../_includes/footer.html')   
 
@@include('../_includes/footer-scripts.html')   

<script>
function refreshCart(name, value) {
	VvvebTheme.Cart.module = 'checkout/checkout';
	VvvebTheme.Cart.component_id = 1;
	//action, parameters, element, selector, callback
	let parameters = {};
	parameters[name] = value;
	VvvebTheme.Cart.ajax('', parameters, null, ['.cart-summary', '.container > .notifications']);
	//cart-summary
}

function toggleBillingAddress(e) {

	let address = $(".billing_address");
	if (e.target.value == 0) {
		$("input,select,textarea", address).prop("disabled", false);	
		address.show();
	} else {
		$("input,select,textarea", address).prop("disabled", true);	
		address.hide();
	}
}

function toggleShippingAddress(element) {
	let address = $(".shipping_address");
	if (element.checked == 0) {
		$("input,select,textarea", address).prop("disabled", true);	
		address.hide();
	} else {
		$("input,select,textarea", address).prop("disabled", false);	
		address.show();
	}
}

function toggleRegister(element) {
	let register = $(".register-account");
	
	if (element.value == 'false') {
		$("input,select,textarea", register).prop("disabled", true);	
		register.hide();
	} else {
		$("input,select,textarea", register).prop("disabled", false);	
		register.show();
	}
}

//show billing address form if no address is selected
$(function() {

	$("body").on("change", "[name=billing_address_id]", toggleBillingAddress);

	if (!$("#billing_address_new").prop("checked") && !$("[name=billing_address_id]:checked").val()) {
		//if new address is not checked and no address is selected
		$("[name=billing_address_id]:first").click();//select first address
	}
	
	let billing_address = $("[name=billing_address_id]:checked");
	//if an address is selected hide billing address form
	if (billing_address.length && billing_address.val() != false) {
		$(".billing_address").hide();
	}
	
	//hide shipping address form if same as billing checkbox is checked
	toggleShippingAddress(document.getElementById("shipping-form-check"));
	
	//if login form is filled show form
	if ($("#checkout-login-form [name=password]").val()) {
		$('#checkout-login-container').show();
		$('#login-form-check').prop("checked", true);
	}
	
	//if shipping or payment method is selected collapse the accordion
	$('.accordion-item input[type="radio"]:checked').parents("label").click();

	$('.accordion-item').on("click", "label", function(e) {
		$(".collapse", e.delegateTarget.parentNode).collapse("hide");
		$(".accordion-button", e.delegateTarget.parentNode).addClass("collapsed");

		$(".accordion-button", e.delegateTarget).toggleClass("collapsed");
		$(".collapse", e.delegateTarget).collapse('toggle');
		
		let input = $('[name="shipping_method"], [name="payment_method"]', this);

		refreshCart(input.attr("name"), input.val());
	});
	
	$("[data-v-countries][readonly]:first").change();
	
});

//load regions for region select when country changes
let regionsUrl = '{ $this->regionsUrl }';
let regions = [];

function addRegionsToSelect(regionSelect, data, region_id = 0, countrySelect) {
	regionSelect.html('');
	for (i in data) {
		let region = data[i];
		regionSelect.append('<option value="' + region.region_id + '">' + region.name + '</option>');
	}
	regionSelect.val(region_id);
	regionSelect.removeAttr("readonly");
	countrySelect.removeAttribute("readonly");
}

$("body").on("change", "[data-v-countries]", function () {
	let regionGroup = $(this).parents(".row");
	let regionSelect = $("[data-v-regions]", regionGroup);
	let country_id = this.value;
	let region_id = this.dataset.vRegionId;
	let self = this;
	this.readonly = false;

	if (country_id) {
		if (regions[country_id]) {
			addRegionsToSelect(regionSelect, regions[country_id], region_id, self);
			$("[data-v-countries][readonly]:first").change();
		} else {
			$.get(regionsUrl + "&country_id=" + country_id).done(function( data ) {
				regions[country_id] = data;
				addRegionsToSelect(regionSelect, data, region_id, self);
				$("[data-v-countries][readonly]:first", self).change();
			});
		}
	}
	
	this.dataset.vRegionId = 0;
});

function togglePasswordInput(element, input) {
	var password = document.getElementById(input);
	if (password.type == "password") {
		password.type = "text"; 
		$("i", element).addClass("la-eye").removeClass("la-eye-slash");
	} else {
		password.type = "password";
		$("i", element).removeClass("la-eye").addClass("la-eye-slash");
	}
}

</script>
</body>
</html>